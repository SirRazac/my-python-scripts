<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Push Notification Test mit Firebase</title>
</head>

<body>
  <h1>Push Notification Test mit Firebase</h1>
  <p id="token">Ger채te-Token wird hier angezeigt</p>

  <!-- Button zum Anfordern der Berechtigung -->
  <button id="requestPermission">Berechtigung anfordern</button>

  <!-- Firebase SDKs -->
  <script type="module">
    // Firebase initialisieren und Token abrufen (index.html)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
    import { getMessaging, getToken } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-messaging.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBwVoTWR6lqBK8BUsQK12l_UQfWLvs_eNo",
      authDomain: "pushtest-a8d7a.firebaseapp.com",
      projectId: "pushtest-a8d7a",
      storageBucket: "pushtest-a8d7a.firebasestorage.app",
      messagingSenderId: "464581164056",
      appId: "1:464581164056:web:5ed0e5c4b7735ff4fc976d",
      measurementId: "G-G20G63ZYCF",
    };

    // Firebase initialisieren
    const app = initializeApp(firebaseConfig);
    const messaging = getMessaging(app);

    // Service Worker registrieren
    navigator.serviceWorker.register('./firebase-messaging-sw.js')
      .then(function (registration) {
        console.log('Service Worker registriert:', registration);
      })
      .catch(function (err) {
        console.log('Fehler bei der Service Worker Registrierung:', err);
      });

    // Berechtigungsanfrage und Token-Abruf
    document.getElementById("requestPermission").addEventListener("click", () => {
      Notification.requestPermission().then((permission) => {
        if (permission === "granted") {
          console.log("Berechtigung erteilt");

          // Ger채tetoken abrufen
          getToken(messaging, {
            vapidKey: "BPyZOwS8jmIdqiZBipv-Qac3q6pPVhOpfdPpwKsI46LC0PufQU944YhHXgAicFJXtLdRL7wG-t8oF64np5DGtS8",
          }).then((currentToken) => {
            if (currentToken) {
              document.getElementById("token").innerText = "Dein Ger채tetoken: " + currentToken;
              console.log("Token erhalten: ", currentToken);
            } else {
              console.log("Kein Token verf체gbar");
            }
          }).catch((err) => {
            console.log("Fehler beim Abrufen des Tokens: ", err);
          });
        } else {
          console.log("Berechtigung verweigert");
        }
      });
    });

  </script>
</body>

</html>